


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>DA14585/DA14586/DA14531 Peripheral BLE- Measuring temperature using MCP9808 or DA14531 internal sensor &#8212; DA14585/DA14586/DA14531 Peripheral BLE- Measuring temperature using MCP9808 or DA14531 internal sensor  documentation</title>
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/jquery-ui.min.css" />
    <link rel="stylesheet" type="text/css" href="_static/style.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="https://s3.amazonaws.com/lpccsdocs/includes/iframeResizer.contentWindow.min.js"></script>
    <script type="text/javascript" src="_static/jquery-ui.min.js"></script>
    <script type="text/javascript" src="_static/myscript.js"></script>
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="#">DA14585/DA14586/DA14531 Peripheral BLE- Measuring temperature using MCP9808 or DA14531 internal sensor</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="da14585-da14586-da14531-peripheral-ble-measuring-temperature-using-mcp9808-or-da14531-internal-sensor">
<span id="da14585-da14586-da14531-peripheral-ble-measuring-temperature-using-mcp9808-or-da14531-internal-sensor"></span><h1>DA14585/DA14586/DA14531 Peripheral BLE- Measuring temperature using MCP9808 or DA14531 internal sensor<a class="headerlink" href="#da14585-da14586-da14531-peripheral-ble-measuring-temperature-using-mcp9808-or-da14531-internal-sensor" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<div class="section" id="example-description">
<span id="example-description"></span><h2>Example description<a class="headerlink" href="#example-description" title="Permalink to this headline">¶</a></h2>
<p>This example shows:</p>
<ul class="simple">
<li>How to use I2C to read MCP9808 temperature register.</li>
<li>How to use I2C to write MCP9808 resolution register.</li>
<li>How to measure the temperature using DA14531 internal temperature sensor.<ul>
<li><strong>The internal temperature sensor is not available for the DA14585 and DA14586.</strong></li>
</ul>
</li>
</ul>
<p>The functionality can be verified by:</p>
<ul class="simple">
<li>BLE notifications.</li>
</ul>
</div>
<div class="section" id="hw-and-sw-configuration">
<span id="hw-and-sw-configuration"></span><h2>HW and SW configuration<a class="headerlink" href="#hw-and-sw-configuration" title="Permalink to this headline">¶</a></h2>
<p>This example runs on the BLE Smart SoC (System on Chip) devices:</p>
<ul class="simple">
<li>DA14585/DA14586 or DA14531 daughter board + DA145xxDEVKT-P PRO-Motherboard.</li>
<li>DA14585/DA14586 daughter board + Basic development Kit mother board.</li>
</ul>
<p>The user manuals for the development kits can be found:</p>
<ul class="simple">
<li><a class="reference external" href="https://www.dialog-semiconductor.com/products/da14531-development-kit-pro">here</a> for the DA145xxDEVKT-P PRO-Motherboard.</li>
<li><a class="reference external" href="https://www.dialog-semiconductor.com/sites/default/files/um-b-048_da14585da14586_getting_started_guide_v2.0_0.pdf">here</a> for the Basic Development Kit.</li>
</ul>
<ul>
<li><p class="first"><strong>Hardware configuration DA14531 using DA145xxDEVKT-P PRO-Motherboard</strong></p>
<ul class="simple">
<li>Using MCP9808 temperature sensor.<ul>
<li>Connect Vdd to V3 on J2 (red line in the image below).</li>
<li>Connect Gnd to ground on J2 (black line in the image below).</li>
<li>Connect SCL to P21 on J2 (yellow line in the image below).</li>
<li>Connect SDA to P23 on J2 (blue line in the image below).</li>
</ul>
</li>
<li>Using internal sensor<ul>
<li>Apply the jumper configuration of the image shown below.</li>
</ul>
</li>
</ul>
<p><img alt="Motherboard_Hardware_Configuration_DA14531" src="_images/Motherboard_Hardware_Configuration_DA14531.png" /></p>
</li>
<li><p class="first"><strong>Hardware configuration DA14585/DA14586 using DA145xxDEVKT-P PRO-Motherboard</strong></p>
<ul class="simple">
<li>Connect Vdd to V3 on J2 (red line in the image below).</li>
<li>Connect Gnd to ground on J2 (black line in the image below).</li>
<li>Connect SCL to P07 on J2 (yellow line in the image below).</li>
<li>Connect SDA to P12 on J2 (blue line in the image below).</li>
</ul>
<p><img alt="Motherboard_Hardware_Configuration_DA14585" src="_images/Motherboard_Hardware_Configuration_DA14585.png" /></p>
</li>
<li><p class="first"><strong>Hardware configuration DA14585 using the basic development kit</strong></p>
<ul class="simple">
<li>Connect Vdd to V3 on J4 (red line in the image below).</li>
<li>Connect Gnd to ground on J4 (black line in the image below).</li>
<li>Connect SCL to P07 on J4 (orange line in the image below).</li>
<li>Connect SDA to P12 on J4 (yellow line in the image below).</li>
</ul>
<p><img alt="Hardware_Configurations" src="_images/MCP9808_Fritzing.png" /></p>
</li>
<li><p class="first"><strong>Software configuration</strong>
This example requires:</p>
<ul class="simple">
<li><a class="reference external" href="https://www.dialog-semiconductor.com/da14531_sdk_latest">SDK6.0.12</a>.</li>
<li>Keil5.</li>
<li><strong>SEGGER’s J-Link</strong> tools should be downloaded and installed..</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="how-to-measure-temperature-using-the-da14531-internal-sensor">
<span id="how-to-measure-temperature-using-the-da14531-internal-sensor"></span><h2>How to measure temperature using the DA14531 internal Sensor<a class="headerlink" href="#how-to-measure-temperature-using-the-da14531-internal-sensor" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">Select</span> <span class="n">the</span> <span class="n">build</span> <span class="k">for</span> <span class="n">DA14531</span><span class="o">.</span>
<span class="o">-</span><span class="n">Uncomment</span> <span class="n">the</span> <span class="n">CFG_USE_INTERNAL_TEMP_SENSOR</span> <span class="n">definition</span> <span class="p">(</span><span class="n">found</span> <span class="ow">in</span> <span class="n">da1458x_config_basic</span><span class="o">.</span><span class="n">h</span><span class="p">)</span> <span class="n">to</span> <span class="n">acquire</span> <span class="n">temperature</span> <span class="n">via</span> <span class="n">the</span> <span class="n">internal</span> <span class="n">temperature</span> <span class="n">sensor</span><span class="o">.</span> <span class="n">See</span> <span class="n">line</span> <span class="mi">205</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">image</span> <span class="n">shown</span> <span class="n">below</span><span class="o">.</span>
</pre></div>
</div>
<p><img alt="da1458x_config_basic_capture" src="_images/da1458x_config_basic_capture.png" /></p>
</div>
<div class="section" id="how-to-run-the-example">
<span id="how-to-run-the-example"></span><h2>How to run the example<a class="headerlink" href="#how-to-run-the-example" title="Permalink to this headline">¶</a></h2>
<div class="section" id="setup">
<span id="setup"></span><h3>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h3>
<p>Before launching the Keil project, make sure to link the SDK and project environment using the Python linker script <code class="docutils literal notranslate"><span class="pre">dlg_make_keil_vx.xxx</span></code>. More information <a class="reference external" href="http://lpccs-docs.dialog-semiconductor.com/Software_Example_Setup/index.html">here</a>.</p>
<ol class="simple">
<li>Start Keil using the <code class="docutils literal notranslate"><span class="pre">ble_temperature_ntf.uvprojx</span></code> Keil project file.</li>
<li>Expand the dialog shown in the red box in the image below.</li>
</ol>
<p><img alt="Expand_Select_Device" src="_images/Expand_Select_Device.png" /></p>
<ol class="simple">
<li>Select your device: DA14531, DA14586 or DA14585.</li>
</ol>
<p><img alt="Select_Device" src="_images/Select_Device.png" /></p>
<ol class="simple">
<li>Compile (F7) and launch (ctrl + F5) the example.If the warning (shown below) pops up press OK.</li>
</ol>
<p><img alt="warning" src="_images/warning.png" /></p>
</div>
</div>
<div class="section" id="expected-results">
<span id="expected-results"></span><h2>Expected Results<a class="headerlink" href="#expected-results" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li>Open the BLE scanner app and look for “DLG-TEMP”.</li>
<li>Connect to the device.</li>
<li>Subscribe to the notifications.</li>
</ol>
<p>If everything went well, you should be able to receive temperature data as the value of the custom characteristic, as shown in the image below.</p>
<p><strong>Note that the DA14531 internal temperature sensor uses int8_t instead of the double temperature value shown below</strong></p>
<p><img alt="BLE_APP_MCP9808_CAPTURE" src="_images/BLE_APP_MCP9808_CAPTURE.png" /></p>
</div>
<div class="section" id="how-it-works">
<span id="how-it-works"></span><h2>How it works<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h2>
<p>Tutorial 3 on the <a class="reference external" href="https://www.dialog-semiconductor.com/sites/default/files/training_03_custom_profile_gatt_cmd_example_v1.2.pdf">Dialog Semiconductor support</a> website shows how to make your own custom profile. The <strong>user_catch_rest_hndl</strong> function in user_peripheral.c will handle the messages for our custom profile. This application only has one possible
custom action: a write to the notification. When this occurs the <strong>user_temperature_message_handler</strong> function is called. This function will check the contents of the write. If the content of the write equals zero, the temperature timer is canceled. If the value is
anything else, a timer is generated that calls <strong>user_send_temperature_ntf</strong> after NOTIFICATION_DELAY ms. <strong>user_send_temperature_ntf</strong> will read out the sensor data and convert it to a string(for demo purposes). The string will be placed in a message, along with some other parameters, like the connection ID
and the characteristic handle. After the message is sent, the app_easy_timer function is used to schedule the next call to the <strong>user_send_temperature_ntf</strong> function. This will ensure the temperature is transmitted regularly. The app_easy_timer function
has a resolution of 10ms hence we divide the desired delay in ms by 10.</p>
</div>
<div class="section" id="troubleshooting">
<span id="troubleshooting"></span><h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Please check that the steps according to your daughter board (DA14531, DA14585 or DA14586) and mother board (basic development kit or DA145xxDEVKT-P PRO-Motherboard) are followed correctly.</li>
<li>Try a different USB1 cable.</li>
<li>Try different jumper wires, if used.</li>
<li>Note that the internal temperature sensor only works for the DA14531</li>
<li>If none of the above helps, please check the user manual according to your daughter board and mother board. User manual can be found <a class="reference external" href="https://www.dialog-semiconductor.com/products/da14531-development-kit-pro">here</a> for the DA145xxDEVKT-P PRO-Motherboard and <a class="reference external" href="https://www.dialog-semiconductor.com/sites/default/files/um-b-048_da14585da14586_getting_started_guide_v2.0_0.pdf">here</a> for the Basic Development Kit</li>
</ul>
</div>
<div class="section" id="license">
<span id="license"></span><h2>License<a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h2>
<hr class="docutils" />
<p>Copyright (c) 2019 Dialog Semiconductor. All rights reserved.</p>
<p>This software (“Software”) is owned by Dialog Semiconductor. By using this Software
you agree that Dialog Semiconductor retains all intellectual property and proprietary
rights in and to this Software and any use, reproduction, disclosure or distribution
of the Software without express written permission or a license agreement from Dialog
Semiconductor is strictly prohibited. This Software is solely for use on or in
conjunction with Dialog Semiconductor products.</p>
<p>EXCEPT AS OTHERWISE PROVIDED IN A LICENSE AGREEMENT BETWEEN THE PARTIES OR AS
REQUIRED BY LAW, THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. EXCEPT AS OTHERWISE PROVIDED
IN A LICENSE AGREEMENT BETWEEN THE PARTIES OR BY LAW, IN NO EVENT SHALL DIALOG
SEMICONDUCTOR BE LIABLE FOR ANY DIRECT, SPECIAL, INDIRECT, INCIDENTAL, OR
CONSEQUENTIAL DAMAGES, OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION,
ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THE SOFTWARE.</p>
<hr class="docutils" />
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="#">
              <img class="logo" src="_static/dslogoBlueSmall.png" alt="Logo"/>
            </a></p>
  <h3><a href="#">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">DA14585/DA14586/DA14531 Peripheral BLE- Measuring temperature using MCP9808 or DA14531 internal sensor</a><ul>
<li><a class="reference internal" href="#example-description">Example description</a></li>
<li><a class="reference internal" href="#hw-and-sw-configuration">HW and SW configuration</a></li>
<li><a class="reference internal" href="#how-to-measure-temperature-using-the-da14531-internal-sensor">How to measure temperature using the DA14531 internal Sensor</a></li>
<li><a class="reference internal" href="#how-to-run-the-example">How to run the example</a><ul>
<li><a class="reference internal" href="#setup">Setup</a></li>
</ul>
</li>
<li><a class="reference internal" href="#expected-results">Expected Results</a></li>
<li><a class="reference internal" href="#how-it-works">How it works</a></li>
<li><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
<li><a class="reference internal" href="#license">License</a></li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="#">DA14585/DA14586/DA14531 Peripheral BLE- Measuring temperature using MCP9808 or DA14531 internal sensor</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Dialog Semiconductor.
    </div>
  </body>
</html>